<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
    $(document).ready(function() {
        var ow = 2592.0;
        var oh = 1458.0;
        var max = 288;
        var index = 0;

        var analysis = [];

        var updateAnalysis = function(runUpdate) {
            $.getJSON("/analysis", function(data) {
                $.each(data, function(key, val) {
                    analysis.push(val)
                });
                if (runUpdate) {
                  update();
                }
            });
        };
        updateAnalysis(true);

        $("#left").click(function(e) {
            left();
        });
        $("#right").click(function(e) {
            right();
        });
        $("#image").click(function(e) {
            var rect = this.getBoundingClientRect();
            var mid = (rect.right - rect.left) / 2.0;
            if (e.offsetX < mid) {
                left();
            } else {
                right();
            }
        });

        var imageResize = function() {
            var ww = $(window).width() - 50;
            var wh = $(window).height() - 50;

            var ra = ww / ow;
            var rb = wh / oh;

            var a = {
                w: ow * ra,
                h: oh * ra
            }

            var b = {
                w: ow * rb,
                h: oh * rb
            }

            var winner = a;

            if (a.w > ww || a.h > wh) {
                winner = b;
            }

            $("#image").attr({
                "width": winner.w,
                "height": winner.h
            });
        };

        imageResize();

        $(window).resize(imageResize);

        $(document).keydown(function(e) {
            switch (e.which) {

                case 37: // left
                    left();
                    break;

                case 39: // right
                    right();
                    break;
            }
        });

        var left = function() {
            if (index == 0) {
                index = max - 1;
            } else {
                index -= 1;
            }
            update();
        };

        var right = function() {
            index = (index + 1) % 288;
            update();
        }

        var update = function() {
            $("#image").attr({
                "src": "/solar/images/" + index
            });
            $("#desc").html("" + index);
            var avgColor = analysis[index].AverageColor;
            $("body").css("background-color", "rgb(" + avgColor.R + "," + avgColor.G + "," + avgColor.B + ")");
        };
    });
    </script>
</head>

<body>
    <div style="float: left;">
        <div>
            <img id="image" width="1000" height="562" src="/solar/images/0" />
        </div>
        <div id="desc">0</div>
        <div>
            <span id="left" style="float: left;">&#8592;</span>
            <span id="right" style="float: right;">&#8594;</span>
        </div>
    </div>
    <div></div>
</body>

</html>
